<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpaceOptions Inventory</title>
<style>
  body { font-family: Arial,sans-serif; margin:0; background:#f4f4f4; }
  header { background:#1f2937; color:white; padding:15px; text-align:center; }
  nav { display:flex; justify-content:center; background:#374151; flex-wrap:wrap; }
  nav button { background:none; border:none; color:white; padding:12px 20px; cursor:pointer; font-size:16px; }
  nav button:hover, nav button.active { background:#2563eb; }
  .tab { display:none; padding:20px; }
  table { width:100%; border-collapse: collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:8px; text-align:left; }
  th { background:#2563eb; color:white; }
  button.small { padding:4px 8px; margin:0 2px; }
  .low { color:red; font-weight:bold; }
  @media(max-width:600px){ nav { flex-direction:column; } }
</style>
</head>
<body>

<header>
  <h1>SpaceOptions Inventory System</h1>
</header>

<!-- Builder PIN Login -->
<div id="login-tab" class="tab" style="display:block; text-align:center; margin-top:50px;">
  <h2>Builder Login</h2>
  <input type="text" id="builder-name" placeholder="Builder Name" style="padding:8px; width:200px;">
  <input type="password" id="builder-pin" placeholder="PIN" style="padding:8px; width:200px; margin-left:10px;">
  <button onclick="loginBuilder()">Login</button>
</div>

<!-- Main Tabs -->
<div id="main-tabs" style="display:none;">
  <nav>
    <button class="tab-btn active" data-tab="inventory">Inventory</button>
    <button class="tab-btn" data-tab="requests">My Requests</button>
    <button class="tab-btn" data-tab="reorder">Reorders</button>
  </nav>

  <!-- Inventory Tab -->
  <div id="inventory" class="tab" style="display:block;">
    <h2>Inventory</h2>
    <table id="inventory-table">
      <thead>
        <tr><th>Material</th><th>Type</th><th>Qty</th><th>Adjust</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="addMaterial()">+ Add Material</button>
  </div>

  <!-- Builder Requests Tab -->
  <div id="requests" class="tab">
    <h2>My Requests</h2>
    <table id="requests-table">
      <thead><tr><th>Job</th><th>Materials</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
    <button onclick="newRequest()">+ New Request</button>
  </div>

  <!-- Reorder Tab -->
  <div id="reorder" class="tab">
    <h2>Reorders (Low Stock)</h2>
    <table id="reorder-table">
      <thead><tr><th>Material</th><th>Qty Needed</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
// ----- Data Helpers -----
function getData(key){ return JSON.parse(localStorage.getItem(key)||'[]'); }
function saveData(key,data){ localStorage.setItem(key,JSON.stringify(data)); }

// ----- Builder Login -----
let currentBuilder = null;
function loginBuilder(){
  const name = document.getElementById('builder-name').value.trim();
  const pin = document.getElementById('builder-pin').value.trim();
  if(!name || !pin){ alert('Enter name and PIN'); return; }
  // check if builder exists
  let builders = getData('builders');
  let builder = builders.find(b=>b.name===name && b.pin===pin);
  if(!builder){
    if(confirm('New builder? Create account?')){
      builder = {name,pin}; builders.push(builder); saveData('builders',builders);
    } else return;
  }
  currentBuilder = builder.name;
  document.getElementById('login-tab').style.display='none';
  document.getElementById('main-tabs').style.display='block';
  renderAll();
}

// ----- Tabs -----
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t=>t.style.display='none');
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).style.display='block';
    renderAll();
  });
});

// ----- Inventory -----
function renderInventory(){
  const tbody = document.querySelector('#inventory-table tbody'); tbody.innerHTML='';
  const materials = getData('materials');
  materials.forEach((m,i)=>{
    tbody.innerHTML+=`<tr>
      <td>${m.name}</td>
      <td>${m.type}</td>
      <td class="${m.qty<=m.minStock?'low':''}">${m.qty}</td>
      <td>
        <button class="small" onclick="adjustQty(${i},1)">+1</button>
        <button class="small" onclick="adjustQty(${i},-1)">-1</button>
      </td>
    </tr>`;
  });
}
function addMaterial(){
  const name = prompt('Material Name'); if(!name) return;
  const type = prompt('Type (wire/wood/hardware)'); if(!type) return;
  const qty = parseInt(prompt('Quantity'),10)||0;
  const minStock = parseInt(prompt('Minimum Stock'),10)||1;
  const materials = getData('materials'); materials.push({name,type,qty,minStock}); saveData('materials',materials);
  renderInventory(); renderReorder();
}
function adjustQty(i,delta){
  const materials = getData('materials'); materials[i].qty += delta; if(materials[i].qty<0) materials[i].qty=0;
  saveData('materials',materials); renderInventory(); renderReorder();
}

// ----- Requests -----
function renderRequests(){
  const tbody = document.querySelector('#requests-table tbody'); tbody.innerHTML='';
  const requests = getData('requests').filter(r=>r.builder===currentBuilder);
  requests.forEach(r=>{
    const list = r.items.map(it=>`${it.name}(${it.qty})`).join(', ');
    tbody.innerHTML+=`<tr><td>${r.job}</td><td>${list}</td><td>${r.status}</td></tr>`;
  });
}
function newRequest(){
  const job = prompt('Job Name'); if(!job) return;
  const materials = getData('materials'); if(materials.length===0){ alert('No materials'); return; }
  let items = [];
  materials.forEach(m=>{
    const qty = parseInt(prompt(`Qty of ${m.name}?`),10);
    if(qty>0) items.push({name:m.name,qty});
  });
  if(items.length===0) return;
  const requests = getData('requests'); requests.push({builder:currentBuilder,job,items,status:'Pending'}); saveData('requests',requests);
  renderRequests();
}

// ----- Reorder Tab -----
function renderReorder(){
  const tbody = document.querySelector('#reorder-table tbody'); tbody.innerHTML='';
  const materials = getData('materials');
  materials.forEach(m=>{
    if(m.qty<=m.minStock){
      const needed = m.minStock*2 - m.qty;
      tbody.innerHTML+=`<tr><td>${m.name}</td><td>${needed}</td></tr>`;
    }
  });
}

// ----- Render All -----
function renderAll(){ renderInventory(); renderRequests(); renderReorder(); }
</script>

</body>
</html>
